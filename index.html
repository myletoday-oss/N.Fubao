<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Learning: V·∫≠n Chuy·ªÉn C√°c Ch·∫•t Qua M√†ng Sinh Ch·∫•t</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #ecfdf5; /* emerald-50 */
            color: #064e3b; /* emerald-900 */
        }

        /* --- Animations --- */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        /* --- Cell Shape Animations (Synchronized 6s) --- */
        @keyframes morph-shrink {
            0% { transform: scale(1); }
            100% { transform: scale(0.7); }
        }
        
        .cell-crenated {
            clip-path: polygon(
                50% 0%, 61% 10%, 75% 5%, 85% 15%, 95% 10%, 90% 25%, 100% 35%, 90% 50%, 
                100% 65%, 90% 75%, 95% 90%, 80% 85%, 70% 95%, 60% 85%, 50% 100%, 40% 85%, 
                30% 95%, 20% 85%, 5% 90%, 10% 75%, 0% 65%, 10% 50%, 0% 35%, 10% 25%, 
                5% 10%, 15% 15%, 25% 5%, 39% 10%
            );
            background-color: #ef4444; 
            transition: clip-path 0.5s ease;
        }

        @keyframes swell-burst {
            0% { transform: scale(1); opacity: 1; border-color: rgba(255,255,255,0.2); }
            80% { transform: scale(1.5); opacity: 0.9; border-radius: 50%; background-color: #f87171; }
            90% { transform: scale(1.6); opacity: 0.5; }
            100% { transform: scale(2); opacity: 0; display: none; }
        }

        /* Particle Jitter */
        @keyframes jitter {
            0% { transform: translate(0, 0); }
            25% { transform: translate(2px, 2px); }
            50% { transform: translate(-2px, -2px); }
            75% { transform: translate(-2px, 2px); }
            100% { transform: translate(0, 0); }
        }
        
        .molecule-particle {
            position: absolute;
            border-radius: 50%;
            transition: all 4s ease-in-out; /* T·ªëc ƒë·ªô di chuy·ªÉn c√¢n b·∫±ng ƒë·ªông */
            z-index: 20;
        }
        
        .molecule-particle.static-jitter {
            animation: jitter 3s infinite linear;
        }

        /* Water Level Animation for U-tube */
        @keyframes rise {
            0% { height: 120px; }
            100% { height: 180px; }
        }
        @keyframes fall {
            0% { height: 120px; }
            100% { height: 60px; }
        }

        /* UI Styles */
        .nav-btn.active { color: #059669; font-weight: 700; }
        .nav-btn::after {
            content: ''; position: absolute; bottom: -2px; left: 50%; width: 0; height: 3px;
            background-color: #059669; transition: all 0.3s ease; transform: translateX(-50%); border-radius: 2px;
        }
        .nav-btn.active::after { width: 80%; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .shriveled-cucumber {
            border-radius: 60% 40% 50% 50% / 50% 55% 45% 50%;
            border: 6px solid #166534; 
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }

        /* Tab Styles in Lab */
        .lab-tab {
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            border: 1px solid transparent;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        .lab-tab.active {
            background-color: #ccfbf1; /* teal-100 */
            color: #0f766e; /* teal-700 */
            border-color: #99f6e4;
        }
        .lab-tab:hover:not(.active) {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-gradient-to-br from-emerald-50 to-teal-100">

    <!-- Header & Navigation -->
    <header class="bg-white/90 backdrop-blur-md shadow-sm z-30 border-b border-emerald-100">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center py-3">
                <div class="flex items-center gap-3 mb-2 md:mb-0">
                    <div class="w-10 h-10 bg-gradient-to-tr from-emerald-500 to-teal-400 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg transform -rotate-3">10</div>
                    <div>
                        <h1 class="font-bold text-lg text-emerald-900 leading-tight">V·∫≠n chuy·ªÉn qua m√†ng sinh ch·∫•t</h1>
                        <p class="text-xs text-emerald-600 font-medium">Sinh h·ªçc 10 - Ch√¢n tr·ªùi s√°ng t·∫°o</p>
                    </div>
                </div>
                <nav class="flex items-center gap-1 overflow-x-auto max-w-full pb-1 md:pb-0 hide-scrollbar">
                    <button onclick="showSection('intro')" id="btn-intro" class="nav-btn active px-4 py-2 text-sm text-gray-600 hover:text-emerald-600 whitespace-nowrap">ü•í Kh·ªüi ƒë·ªông</button>
                    <button onclick="showSection('concept')" id="btn-concept" class="nav-btn px-4 py-2 text-sm text-gray-600 hover:text-emerald-600 whitespace-nowrap">üß¨ Ki·∫øn th·ª©c</button>
                    <button onclick="showSection('passive')" id="btn-passive" class="nav-btn px-4 py-2 text-sm text-gray-600 hover:text-emerald-600 whitespace-nowrap">üåä V·∫≠n chuy·ªÉn</button>
                    <button onclick="showSection('lab')" id="btn-lab" class="nav-btn px-4 py-2 text-sm text-teal-600 font-bold hover:text-teal-700 whitespace-nowrap bg-teal-50 rounded-lg mx-2 border border-teal-100">üß™ PTN ·∫¢o</button>
                    <button onclick="showSection('bulk')" id="btn-bulk" class="nav-btn px-4 py-2 text-sm text-gray-600 hover:text-emerald-600 whitespace-nowrap">üì¶ Nh·∫≠p/Xu·∫•t b√†o</button>
                    <button onclick="showSection('practice')" id="btn-practice" class="nav-btn px-4 py-2 text-sm text-gray-600 hover:text-emerald-600 whitespace-nowrap">üìù Luy·ªán t·∫≠p</button>
                    <button onclick="showSection('apply')" id="btn-apply" class="nav-btn px-4 py-2 text-sm text-gray-600 hover:text-emerald-600 whitespace-nowrap">üè∫ V·∫≠n d·ª•ng</button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex-1 overflow-y-auto relative scroll-smooth p-4 md:p-8" id="main-content">
        <div class="max-w-6xl mx-auto min-h-full">
            
            <!-- SECTION 1: INTRO -->
            <section id="sec-intro" class="space-y-8 animate-[float_0.5s_ease-out]">
                <div class="text-center mb-10">
                    <span class="bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">Ho·∫°t ƒë·ªông 1</span>
                    <h2 class="text-3xl font-bold text-emerald-900 mt-2">T√¨nh hu·ªëng Kh·ªüi ƒë·ªông</h2>
                    <p class="text-emerald-600">Quan s√°t hi·ªán t∆∞·ª£ng th·ª±c t·∫ø v·ªõi D∆∞a leo/C√† r·ªët</p>
                </div>
                <div class="bg-white/80 backdrop-blur rounded-3xl shadow-xl border border-emerald-100 overflow-hidden">
                    <div class="p-8 md:p-12">
                        <div class="flex flex-col md:flex-row gap-12 items-center justify-center mb-10">
                            <!-- Bowl 1 -->
                            <div class="text-center group cursor-pointer transition-all duration-300 hover:-translate-y-2" onclick="toggleObservation('bowl1')">
                                <div class="relative w-48 h-48 bg-gradient-to-b from-blue-50 to-blue-100 rounded-full border-4 border-white shadow-lg flex items-center justify-center overflow-hidden mx-auto">
                                    <div class="absolute inset-0 bg-blue-400/10 animate-pulse"></div>
                                    <div class="relative w-28 h-28 bg-green-200 rounded-full border-[6px] border-green-500 flex items-center justify-center shadow-md transform group-hover:scale-105 transition-transform">
                                        <div class="w-24 h-24 bg-green-300/40 rounded-full border border-green-400 grid grid-cols-3 grid-rows-3 gap-1 p-2 opacity-60">
                                            <div class="bg-white/60 rounded-full"></div><div></div><div class="bg-white/60 rounded-full"></div><div></div><div class="bg-white/60 rounded-full"></div><div></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-4 inline-block px-4 py-1 bg-blue-100 text-blue-700 rounded-full font-bold shadow-sm">B√°t 1: N∆∞·ªõc l·ªçc</div>
                                <div id="obs-bowl1" class="text-sm font-medium text-emerald-600 mt-2 hidden bg-white px-3 py-1 rounded-lg shadow-sm inline-block">ü•í T∆∞∆°i, cƒÉng m·ªçng, c·ª©ng</div>
                            </div>

                            <!-- Bowl 2 -->
                            <div class="text-center group cursor-pointer transition-all duration-300 hover:-translate-y-2" onclick="toggleObservation('bowl2')">
                                <div class="relative w-48 h-48 bg-gradient-to-b from-gray-100 to-gray-200 rounded-full border-4 border-white shadow-lg flex items-center justify-center overflow-hidden mx-auto">
                                    <div class="absolute inset-0 bg-yellow-400/5"></div>
                                    <div class="absolute w-2 h-2 bg-white rounded-full top-10 left-10 opacity-80"></div>
                                    <div class="absolute w-2 h-2 bg-white rounded-full bottom-12 right-12 opacity-80"></div>
                                    <div class="relative w-24 h-24 bg-green-300 flex items-center justify-center shadow-md transform transition-all duration-1000 shriveled-cucumber" 
                                         id="salt-slice"
                                         style="border-radius: 50%; transform: scale(1);"> 
                                         <div class="w-16 h-16 bg-green-400/40 rounded-full border border-green-500 opacity-60"></div>
                                    </div>
                                </div>
                                <div class="mt-4 inline-block px-4 py-1 bg-orange-100 text-orange-700 rounded-full font-bold shadow-sm">B√°t 2: N∆∞·ªõc mu·ªëi ƒë·∫∑c</div>
                                <div id="obs-bowl2" class="text-sm font-medium text-orange-600 mt-2 hidden bg-white px-3 py-1 rounded-lg shadow-sm inline-block">ü•Ä M·ªÅm, teo nh·ªè, d·∫ªo</div>
                            </div>
                        </div>
                        <div class="bg-emerald-50/80 p-6 rounded-2xl border border-emerald-100 max-w-3xl mx-auto">
                            <h3 class="font-bold text-emerald-900 mb-4 flex items-center gap-2"><span class="text-xl">ü§î</span> C√¢u h·ªèi th·∫£o lu·∫≠n</h3>
                            <div class="space-y-4">
                                <div class="flex gap-4 p-3 bg-white rounded-xl shadow-sm border border-emerald-50">
                                    <div class="bg-emerald-100 text-emerald-700 w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0">1</div>
                                    <p class="text-gray-700">T·∫°i sao c√πng l√† d∆∞a leo nh∆∞ng mi·∫øng ng√¢m n∆∞·ªõc l·ªçc v·∫´n t∆∞∆°i, c√≤n mi·∫øng ng√¢m n∆∞·ªõc mu·ªëi l·∫°i b·ªã teo?</p>
                                </div>
                                <div class="flex gap-4 p-3 bg-white rounded-xl shadow-sm border border-emerald-50">
                                    <div class="bg-emerald-100 text-emerald-700 w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0">2</div>
                                    <p class="text-gray-700">ƒêi·ªÅu g√¨ ƒë√£ x·∫£y ra v·ªõi c√°c ph√¢n t·ª≠ n∆∞·ªõc trong 2 tr∆∞·ªùng h·ª£p n√†y?</p>
                                </div>
                            </div>
                            <div class="mt-6 text-center">
                                <button onclick="document.getElementById('intro-hint').classList.remove('hidden')" class="text-sm font-bold text-teal-600 hover:text-teal-800 underline decoration-dotted underline-offset-4 transition">üí° G·ª£i √Ω cho gi√°o vi√™n</button>
                                <p id="intro-hint" class="hidden mt-3 text-sm text-teal-800 bg-teal-100 p-3 rounded-lg inline-block">"N∆∞·ªõc di chuy·ªÉn t·ª´ n∆°i th·∫ø n∆∞·ªõc cao sang n∆°i th·∫ø n∆∞·ªõc th·∫•p. Trong b√°t n∆∞·ªõc mu·ªëi, n∆∞·ªõc t·ª´ b√™n trong t·∫ø b√†o d∆∞a leo ƒë√£ b·ªã 'h√∫t' ra ngo√†i."</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION 2: CONCEPT -->
            <section id="sec-concept" class="hidden space-y-8 animate-[float_0.5s_ease-out]">
                <div class="text-center mb-8">
                    <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">Ki·∫øn th·ª©c n·ªÅn</span>
                    <h2 class="text-3xl font-bold text-slate-800 mt-2">Trao ƒë·ªïi ch·∫•t ·ªü t·∫ø b√†o</h2>
                </div>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="glass-panel p-8 rounded-3xl shadow-sm hover:shadow-md transition-shadow">
                        <div class="w-14 h-14 bg-blue-100 rounded-2xl flex items-center justify-center text-3xl mb-6 text-blue-600">üîÑ</div>
                        <h3 class="font-bold text-xl mb-3 text-slate-800">ƒê·ªãnh nghƒ©a</h3>
                        <p class="text-slate-600 leading-relaxed">Trao ƒë·ªïi ch·∫•t ·ªü t·∫ø b√†o bao g·ªìm qu√° tr√¨nh trao ƒë·ªïi ch·∫•t gi·ªØa t·∫ø b√†o v·ªõi m√¥i tr∆∞·ªùng v√† c√°c ph·∫£n ·ª©ng sinh h√≥a di·ªÖn ra b√™n trong t·∫ø b√†o. Qu√° tr√¨nh chuy·ªÉn h√≥a v·∫≠t ch·∫•t trong t·∫ø b√†o bao g·ªìm c√≥ ƒë·ªìng h√≥a v√† d·ªã h√≥a.</p>
                    </div>
                    <div class="glass-panel p-8 rounded-3xl shadow-sm hover:shadow-md transition-shadow">
                        <div class="w-14 h-14 bg-emerald-100 rounded-2xl flex items-center justify-center text-3xl mb-6 text-emerald-600">üõ°Ô∏è</div>
                        <h3 class="font-bold text-xl mb-3 text-slate-800">Vai tr√≤ m√†ng sinh ch·∫•t</h3>
                        <p class="text-slate-600 leading-relaxed">ƒê√≥ng vai tr√≤ nh∆∞ "ng∆∞·ªùi g√°c c·ªïng", ki·ªÉm so√°t c√°c ch·∫•t ra/v√†o t·∫ø b√†o m·ªôt c√°ch c√≥ ch·ªçn l·ªçc. Gi√∫p duy tr√¨ m√¥i tr∆∞·ªùng n·ªôi b√†o ·ªïn ƒë·ªãnh ƒë·ªÉ t·∫ø b√†o ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng.</p>
                    </div>
                </div>
            </section>

            <!-- SECTION 3: TRANSPORT -->
            <section id="sec-passive" class="hidden space-y-8 animate-[float_0.5s_ease-out]">
                
                <div class="grid grid-cols-2 gap-4 md:gap-8">
                    <!-- Passive -->
                    <div class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden group">
                        <div class="h-2 bg-gradient-to-r from-green-400 to-green-600"></div>
                        <div class="p-4 md:p-8">
                            <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 md:mb-6">
                                <h3 class="font-bold text-xl md:text-2xl text-green-800">Th·ª• ƒë·ªông</h3>
                                <span class="bg-green-100 text-green-700 text-xs font-bold px-2 py-1 rounded w-fit">Passive</span>
                            </div>
                            
                            <ul class="space-y-4 text-sm md:text-base">
                                <li class="flex items-start gap-2 md:gap-3">
                                    <span class="bg-green-100 p-1 rounded text-green-600 text-lg">‚úÖ</span>
                                    <div>
                                        <strong class="block text-slate-800">Nguy√™n l√Ω</strong>
                                        <span class="text-slate-500">N·ªìng ƒë·ªô Cao ‚ûî Th·∫•p (Xu√¥i d√≤ng)</span>
                                    </div>
                                </li>
                                <li class="flex items-start gap-2 md:gap-3">
                                    <span class="bg-green-100 p-1 rounded text-green-600 text-lg">‚ö°</span>
                                    <div>
                                        <strong class="block text-slate-800">NƒÉng l∆∞·ª£ng</strong>
                                        <span class="text-slate-500">Kh√¥ng t·ªën ATP</span>
                                    </div>
                                </li>
                                <li class="flex items-start gap-2 md:gap-3">
                                    <span class="bg-green-100 p-1 rounded text-green-600 text-lg">üîç</span>
                                    <div>
                                        <strong class="block text-slate-800">V√≠ d·ª•</strong>
                                        <span class="text-slate-500">O2, CO2, H2O, Glucose (qua k√™nh protein)</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Active -->
                    <div class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden group">
                        <div class="h-2 bg-gradient-to-r from-red-400 to-red-600"></div>
                        <div class="p-4 md:p-8">
                            <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 md:mb-6">
                                <h3 class="font-bold text-xl md:text-2xl text-red-800">Ch·ªß ƒë·ªông</h3>
                                <span class="bg-red-100 text-red-700 text-xs font-bold px-2 py-1 rounded w-fit">Active</span>
                            </div>
                            
                            <ul class="space-y-4 text-sm md:text-base">
                                <li class="flex items-start gap-2 md:gap-3">
                                    <span class="bg-red-100 p-1 rounded text-red-600 text-lg">‚öôÔ∏è</span>
                                    <div>
                                        <strong class="block text-slate-800">Nguy√™n l√Ω</strong>
                                        <span class="text-slate-500">N·ªìng ƒë·ªô Th·∫•p ‚ûî Cao (Ng∆∞·ª£c d√≤ng)</span>
                                    </div>
                                </li>
                                <li class="flex items-start gap-2 md:gap-3">
                                    <span class="bg-red-100 p-1 rounded text-red-600 text-lg">‚ö°</span>
                                    <div>
                                        <strong class="block text-slate-800">NƒÉng l∆∞·ª£ng</strong>
                                        <span class="text-slate-500">C·∫ßn ti√™u t·ªën ATP</span>
                                    </div>
                                </li>
                                <li class="flex items-start gap-2 md:gap-3">
                                    <span class="bg-red-100 p-1 rounded text-red-600 text-lg">üîç</span>
                                    <div>
                                        <strong class="block text-slate-800">V√≠ d·ª•</strong>
                                        <span class="text-slate-500">B∆°m Na-K, t√°i h·∫•p thu t·∫°i ·ªëng th·∫≠n, <strong>Protein v·∫≠n chuy·ªÉn n∆∞·ªõc Aquaporin</strong></span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION 5: LAB (COMPLETE WITH 3 TABS) -->
            <section id="sec-lab" class="hidden min-h-[650px] flex-col animate-[float_0.5s_ease-out]">
                <div class="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden flex flex-col h-full">
                    
                    <!-- Lab Tabs Header -->
                    <div class="bg-slate-50 border-b border-slate-200 p-4 flex gap-2 overflow-x-auto">
                        <button onclick="switchLabTab('diffusion')" id="tab-diffusion" class="lab-tab active">1. Khu·∫øch t√°n (Diffusion)</button>
                        <button onclick="switchLabTab('osmosis-basic')" id="tab-osmosis-basic" class="lab-tab text-gray-500">2. Th·∫©m th·∫•u (C∆° b·∫£n)</button>
                        <button onclick="switchLabTab('osmosis-cell')" id="tab-osmosis-cell" class="lab-tab text-gray-500">3. Th·∫©m th·∫•u (T·∫ø b√†o)</button>
                    </div>

                    <!-- LAB 1: DIFFUSION -->
                    <div id="lab-diffusion" class="flex flex-col md:flex-row flex-1">
                        <div class="w-full md:w-80 bg-slate-50 border-r border-slate-100 p-8 flex flex-col gap-4 z-10">
                            <div class="mb-4">
                                <h2 class="text-2xl font-bold text-teal-800">Khu·∫øch t√°n</h2>
                                <p class="text-sm text-slate-500">S·ª± di chuy·ªÉn c·ªßa ch·∫•t tan</p>
                            </div>
                            <div class="p-4 bg-white rounded-xl shadow-sm border border-slate-100 text-sm text-slate-600">
                                <p class="mb-2 font-bold">Nguy√™n l√Ω:</p>
                                <p>Ch·∫•t tan di chuy·ªÉn t·ª´ n∆°i <strong>n·ªìng ƒë·ªô cao</strong> sang n∆°i <strong>n·ªìng ƒë·ªô th·∫•p</strong> cho ƒë·∫øn khi ƒë·∫°t tr·∫°ng th√°i <strong>c√¢n b·∫±ng ƒë·ªông</strong> (c√°c h·∫°t v·∫´n chuy·ªÉn ƒë·ªông nh∆∞ng n·ªìng ƒë·ªô 2 b√™n b·∫±ng nhau).</p>
                            </div>
                            <button onclick="runDiffusion()" class="mt-4 w-full py-3 bg-teal-600 hover:bg-teal-700 text-white rounded-xl font-bold shadow-md transition transform hover:-translate-y-1">‚ñ∂Ô∏è B·∫Øt ƒë·∫ßu</button>
                            <button onclick="resetDiffusion()" class="w-full py-2 bg-white border border-slate-300 text-slate-600 hover:bg-slate-50 rounded-xl font-bold transition">üîÑ L√†m l·∫°i</button>
                        </div>
                        <div class="flex-1 bg-[#002b5b] relative overflow-hidden flex items-center justify-center p-8">
                            <div class="relative w-[500px] h-[300px] border-4 border-white/50 rounded-xl bg-white/5 backdrop-blur-sm flex">
                                <!-- Background Labels -->
                                <div class="w-1/2 h-full border-r-2 border-dashed border-white/40 flex items-center justify-center relative z-0">
                                    <div id="diff-label-left" class="absolute bottom-2 text-white/50 text-xs font-bold uppercase transition-all">N·ªìng ƒë·ªô Cao</div>
                                </div>
                                <div class="w-1/2 h-full flex items-center justify-center relative z-0">
                                    <div id="diff-label-right" class="absolute bottom-2 text-white/50 text-xs font-bold uppercase transition-all">N·ªìng ƒë·ªô Th·∫•p</div>
                                </div>
                                <!-- Particles Container -->
                                <div id="diffusion-particles" class="absolute inset-0 pointer-events-none z-10"></div>
                            </div>
                        </div>
                    </div>

                    <!-- LAB 2: OSMOSIS BASIC (BEAKER) -->
                    <div id="lab-osmosis-basic" class="hidden flex flex-col md:flex-row flex-1">
                        <div class="w-full md:w-80 bg-slate-50 border-r border-slate-100 p-8 flex flex-col gap-4 z-10">
                            <div class="mb-4">
                                <h2 class="text-2xl font-bold text-teal-800">Th·∫©m th·∫•u (C∆° b·∫£n)</h2>
                                <p class="text-sm text-slate-500">S·ª± di chuy·ªÉn c·ªßa n∆∞·ªõc qua m√†ng</p>
                            </div>
                            <div class="p-4 bg-white rounded-xl shadow-sm border border-slate-100 text-sm text-slate-600">
                                <p class="mb-2 font-bold">Th√≠ nghi·ªám:</p>
                                <p>M·ªôt b·ªÉ n∆∞·ªõc ƒë∆∞·ª£c ngƒÉn ƒë√¥i b·ªüi m√†ng b√°n th·∫•m. B√™n ph·∫£i c√≥ <strong>nhi·ªÅu ch·∫•t tan</strong> h∆°n.</p>
                            </div>
                            <button onclick="runOsmosisBasic()" class="mt-4 w-full py-3 bg-teal-600 hover:bg-teal-700 text-white rounded-xl font-bold shadow-md transition transform hover:-translate-y-1">‚ñ∂Ô∏è Quan s√°t</button>
                            <button onclick="resetOsmosisBasic()" class="w-full py-2 bg-white border border-slate-300 text-slate-600 hover:bg-slate-50 rounded-xl font-bold transition">üîÑ L√†m l·∫°i</button>
                        </div>
                        <div class="flex-1 bg-[#002b5b] relative overflow-hidden flex items-center justify-center p-8">
                            
                            <!-- Beaker Container -->
                            <div class="relative w-[400px] h-[300px] border-4 border-white/60 border-t-0 rounded-b-xl bg-white/5 backdrop-blur-sm shadow-xl">
                                
                                <!-- The Membrane -->
                                <div class="absolute inset-y-0 left-1/2 w-1 -translate-x-1/2 border-l-4 border-dashed border-red-400/70 z-20"></div>

                                <!-- Water Left -->
                                <div id="water-left-beaker" class="absolute bottom-0 left-0 w-1/2 bg-blue-500/60 transition-all duration-[4s] ease-in-out border-r border-blue-400/30 z-10" style="height: 150px;">
                                    <div class="absolute top-0 w-full h-1 bg-blue-300/80"></div>
                                    <!-- Solutes Left (Few) -->
                                    <div id="solutes-left-beaker" class="absolute inset-0 pointer-events-none z-10"></div>
                                </div>

                                <!-- Water Right -->
                                <div id="water-right-beaker" class="absolute bottom-0 right-0 w-1/2 bg-blue-500/60 transition-all duration-[4s] ease-in-out border-l border-blue-400/30 z-10" style="height: 150px;">
                                    <div class="absolute top-0 w-full h-1 bg-blue-300/80"></div>
                                    <!-- Solutes Right (Many) -->
                                    <div id="solutes-right-beaker" class="absolute inset-0 pointer-events-none z-10"></div>
                                </div>
                                
                                <!-- Arrow -->
                                <div id="osmosis-arrow" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-white text-5xl font-bold opacity-0 transition-opacity duration-1000 z-30 drop-shadow-lg filter drop-shadow-lg">
                                    ‚û°Ô∏è
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- LAB 3: OSMOSIS CELL -->
                    <div id="lab-osmosis-cell" class="hidden flex flex-col md:flex-row flex-1">
                        <div class="w-full md:w-80 bg-slate-50 border-r border-slate-100 p-8 flex flex-col gap-4 z-10">
                            <div class="mb-4">
                                <h2 class="text-2xl font-bold text-teal-800">Th·∫©m th·∫•u (T·∫ø b√†o)</h2>
                                <p class="text-sm text-slate-500">Th√≠ nghi·ªám tr√™n t·∫ø b√†o H·ªìng c·∫ßu</p>
                            </div>
                            <div class="space-y-3">
                                <button onclick="runLab('hyper')" class="w-full p-4 rounded-2xl border-2 border-transparent bg-white shadow-sm hover:border-orange-300 hover:bg-orange-50 transition-all text-left group">
                                    <div class="font-bold text-slate-700 group-hover:text-orange-700">1. ∆Øu tr∆∞∆°ng</div>
                                    <div class="text-xs text-slate-400 group-hover:text-orange-600">Mu·ªëi nhi·ªÅu (Hypertonic)</div>
                                </button>
                                <button onclick="runLab('iso')" class="w-full p-4 rounded-2xl border-2 border-transparent bg-white shadow-sm hover:border-green-300 hover:bg-green-50 transition-all text-left group">
                                    <div class="font-bold text-slate-700 group-hover:text-green-700">2. ƒê·∫≥ng tr∆∞∆°ng</div>
                                    <div class="text-xs text-slate-400 group-hover:text-green-600">C√¢n b·∫±ng (Isotonic)</div>
                                </button>
                                <button onclick="runLab('hypo')" class="w-full p-4 rounded-2xl border-2 border-transparent bg-white shadow-sm hover:border-blue-300 hover:bg-blue-50 transition-all text-left group">
                                    <div class="font-bold text-slate-700 group-hover:text-blue-700">3. Nh∆∞·ª£c tr∆∞∆°ng</div>
                                    <div class="text-xs text-slate-400 group-hover:text-blue-600">N∆∞·ªõc c·∫•t (Hypotonic)</div>
                                </button>
                            </div>
                            <div id="lab-result" class="mt-auto p-4 rounded-xl bg-slate-800 text-white text-sm hidden shadow-lg transform transition-all"></div>
                            <div class="mt-4 p-4 bg-slate-100 rounded-lg text-xs text-slate-600 space-y-2">
                                <div class="font-bold text-slate-800 mb-1">Ch√∫ th√≠ch:</div>
                                <div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-green-400 border border-white inline-block"></span><span>Ch·∫•t tan (NaCl)</span></div>
                                <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-blue-400 inline-block"></span><span>Ph√¢n t·ª≠ N∆∞·ªõc</span></div>
                                <div class="flex items-center gap-2"><span class="text-lg">‚ûî</span><span>H∆∞·ªõng n∆∞·ªõc di chuy·ªÉn</span></div>
                            </div>
                        </div>

                        <!-- Visual Area -->
                        <div class="flex-1 bg-[#002b5b] relative overflow-hidden flex items-center justify-center p-8">
                            <div id="molecules-layer" class="absolute inset-0 pointer-events-none z-30"></div>
                            <div class="absolute w-[450px] h-[450px] rounded-[40px] border-2 border-white/80 shadow-2xl backdrop-blur-[2px] bg-white/5 pointer-events-none z-0"></div>
                            <div id="arrows-container" class="absolute inset-0 z-20 pointer-events-none flex items-center justify-center"></div>
                            <div id="cell-wrapper" class="relative w-48 h-48 flex items-center justify-center z-10 transition-all duration-1000">
                                <div id="cell-normal" class="absolute inset-0 bg-red-700 rounded-full shadow-[inset_0px_0px_30px_rgba(0,0,0,0.5),0_10px_20px_rgba(0,0,0,0.5)] flex items-center justify-center border-0 overflow-hidden transition-all duration-1000">
                                    <div class="absolute w-28 h-28 bg-red-900/40 rounded-full blur-md top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></div>
                                </div>
                                 <div id="cell-crenated-bg" class="absolute inset-0 bg-red-700 shadow-lg hidden"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION 4: BULK -->
            <section id="sec-bulk" class="hidden space-y-8 animate-[float_0.5s_ease-out]">
                <div class="text-center mb-8">
                    <span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">Bi·∫øn d·∫°ng m√†ng</span>
                    <h2 class="text-3xl font-bold text-slate-800 mt-2">Nh·∫≠p b√†o & Xu·∫•t b√†o</h2>
                    <p class="text-slate-500 mt-2">D√†nh cho c√°c ƒë·∫°i ph√¢n t·ª≠ (Protein, Vi khu·∫©n...)</p>
                </div>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white p-8 rounded-3xl border border-purple-100 shadow-sm relative overflow-hidden group hover:shadow-lg transition">
                        <div class="absolute -right-10 -top-10 w-32 h-32 bg-purple-50 rounded-full group-hover:bg-purple-100 transition"></div>
                        <h3 class="font-bold text-2xl mb-4 text-purple-800 relative z-10 flex items-center gap-3"><span class="text-3xl">üì•</span> Nh·∫≠p b√†o</h3>
                        <div class="space-y-4 relative z-10">
                            <div class="bg-purple-50 p-4 rounded-2xl border border-purple-100"><span class="font-bold block text-purple-900">Th·ª±c b√†o (ƒÇn)</span><span class="text-sm text-purple-600">M√†ng l√µm v√†o bao l·∫•y ch·∫•t r·∫Øn.</span></div>
                            <div class="bg-purple-50 p-4 rounded-2xl border border-purple-100"><span class="font-bold block text-purple-900">·∫®m b√†o (U·ªëng)</span><span class="text-sm text-purple-600">M√†ng l√µm v√†o bao l·∫•y gi·ªçt d·ªãch.</span></div>
                        </div>
                    </div>
                    <div class="bg-white p-8 rounded-3xl border border-orange-100 shadow-sm relative overflow-hidden group hover:shadow-lg transition">
                        <div class="absolute -right-10 -top-10 w-32 h-32 bg-orange-50 rounded-full group-hover:bg-orange-100 transition"></div>
                        <h3 class="font-bold text-2xl mb-4 text-orange-800 relative z-10 flex items-center gap-3"><span class="text-3xl">üì§</span> Xu·∫•t b√†o</h3>
                        <p class="text-slate-600 mb-4 relative z-10 leading-relaxed">T√∫i ti·∫øt ch·ª©a ch·∫•t (hormone, enzyme) di chuy·ªÉn ƒë·∫øn m√†ng sinh ch·∫•t ‚ûî H√≤a nh·∫≠p m√†ng ‚ûî ƒê·∫©y ch·∫•t ra ngo√†i.</p>
                        <div class="inline-block px-3 py-1 bg-orange-100 text-orange-700 rounded text-sm font-bold">‚ö†Ô∏è Lu√¥n ti√™u t·ªën ATP</div>
                    </div>
                </div>
            </section>

            <!-- SECTION 6: PRACTICE -->
            <section id="sec-practice" class="hidden max-w-3xl mx-auto animate-[float_0.5s_ease-out]">
                <div class="bg-white p-10 rounded-3xl shadow-xl border border-slate-100">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-3"><span class="bg-yellow-100 p-2 rounded-lg text-2xl">üìù</span> ƒêi·ªÅn t·ª´ c√≤n thi·∫øu</h2>
                    <div class="text-lg leading-loose text-slate-600 font-medium">
                        "S·ª± v·∫≠n chuy·ªÉn ch·∫•t t·ª´ n∆°i c√≥ n·ªìng ƒë·ªô <select id="q1" class="border-b-2 border-emerald-300 bg-emerald-50 text-emerald-800 font-bold outline-none px-3 py-1 rounded cursor-pointer hover:bg-emerald-100 transition"><option value="">...</option><option value="cao">cao</option><option value="th·∫•p">th·∫•p</option></select> sang n∆°i c√≥ n·ªìng ƒë·ªô <select id="q2" class="border-b-2 border-emerald-300 bg-emerald-50 text-emerald-800 font-bold outline-none px-3 py-1 rounded cursor-pointer hover:bg-emerald-100 transition"><option value="">...</option><option value="cao">cao</option><option value="th·∫•p">th·∫•p</option></select> m√† kh√¥ng ti√™u t·ªën nƒÉng l∆∞·ª£ng g·ªçi l√† <select id="q3" class="border-b-2 border-emerald-300 bg-emerald-50 text-emerald-800 font-bold outline-none px-3 py-1 rounded cursor-pointer hover:bg-emerald-100 transition"><option value="">...</option><option value="ch·ªß ƒë·ªông">v·∫≠n chuy·ªÉn ch·ªß ƒë·ªông</option><option value="th·ª• ƒë·ªông">v·∫≠n chuy·ªÉn th·ª• ƒë·ªông</option></select>. N∆∞·ªõc lu√¥n th·∫©m th·∫•u t·ª´ m√¥i tr∆∞·ªùng <select id="q4" class="border-b-2 border-emerald-300 bg-emerald-50 text-emerald-800 font-bold outline-none px-3 py-1 rounded cursor-pointer hover:bg-emerald-100 transition"><option value="">...</option><option value="∆∞u tr∆∞∆°ng">∆∞u tr∆∞∆°ng</option><option value="nh∆∞·ª£c tr∆∞∆°ng">nh∆∞·ª£c tr∆∞∆°ng</option></select> (th·∫ø n∆∞·ªõc cao) sang m√¥i tr∆∞·ªùng <select id="q5" class="border-b-2 border-emerald-300 bg-emerald-50 text-emerald-800 font-bold outline-none px-3 py-1 rounded cursor-pointer hover:bg-emerald-100 transition"><option value="">...</option><option value="∆∞u tr∆∞∆°ng">∆∞u tr∆∞∆°ng</option><option value="nh∆∞·ª£c tr∆∞∆°ng">nh∆∞·ª£c tr∆∞∆°ng</option></select>."
                    </div>
                    <div class="mt-8 flex items-center justify-between">
                        <div id="quiz-feedback" class="hidden text-sm font-bold px-4 py-2 rounded-lg"></div>
                        <button onclick="checkQuiz()" class="bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transform hover:-translate-y-1 transition-all">Ki·ªÉm tra</button>
                    </div>
                </div>
            </section>

            <!-- SECTION 7: APPLY -->
            <section id="sec-apply" class="hidden animate-[float_0.5s_ease-out]">
                <div class="max-w-4xl mx-auto bg-gradient-to-br from-white to-orange-50 p-10 rounded-3xl shadow-xl border border-orange-100 min-h-[500px] flex flex-col justify-center">
                    <div id="apply-slide-1" class="transition-all duration-500">
                        <div class="text-center mb-10">
                            <div class="inline-block p-4 bg-orange-100 rounded-full text-4xl mb-4 shadow-sm">ü•¨</div>
                            <h2 class="text-3xl font-bold text-orange-900">Gi·∫£i th√≠ch hi·ªán t∆∞·ª£ng "Mu·ªëi d∆∞a"</h2>
                            <p class="text-orange-700/80 mt-2 font-medium italic">"Mu·ªëi d∆∞a, d∆∞a kh√∫ - Mu·ªëi c√†, c√† teo"</p>
                        </div>
                        <div class="space-y-8 text-center max-w-2xl mx-auto">
                            <p class="text-slate-600 text-lg leading-relaxed">Khi ta ng√¢m rau c·∫£i v√†o n∆∞·ªõc mu·ªëi, sau m·ªôt th·ªùi gian, rau b·ªã <strong>teo nh·ªè l·∫°i</strong>, dai h∆°n v√† n∆∞·ªõc trong h≈© tr·ªü n√™n <strong>ƒë·ª•c v√† chua</strong>.</p>
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-orange-100 inline-block text-left"><strong class="text-orange-800 block mb-2 text-lg">üîç Hi·ªán t∆∞·ª£ng quan s√°t ƒë∆∞·ª£c:</strong><span class="text-slate-500 text-lg">Co nguy√™n sinh (T·∫ø b√†o m·∫•t n∆∞·ªõc)</span></div>
                            <div class="pt-4"><button onclick="toggleApplySlide(2)" class="bg-gradient-to-r from-orange-400 to-orange-600 hover:from-orange-500 hover:to-orange-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform hover:-translate-y-1 transition-all flex items-center gap-2 mx-auto text-lg">Xem gi·∫£i th√≠ch c∆° ch·∫ø ‚û°Ô∏è</button></div>
                        </div>
                    </div>
                    <div id="apply-slide-2" class="hidden transition-all duration-500">
                        <div class="text-center mb-8"><span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">Ki·∫øn th·ª©c c·ªët l√µi</span><h2 class="text-3xl font-bold text-orange-900 mt-2">C∆° ch·∫ø Th·∫©m th·∫•u</h2></div>
                        <div class="bg-white/60 p-8 rounded-3xl border border-orange-200 shadow-sm max-w-3xl mx-auto">
                            <ul class="space-y-6">
                                <li class="flex gap-4 items-start"><div class="bg-orange-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0 shadow-md mt-1">1</div><div><p class="text-lg text-slate-800">M√¥i tr∆∞·ªùng n∆∞·ªõc mu·ªëi l√† <strong>∆Øu tr∆∞∆°ng</strong>.</p><p class="text-sm text-slate-500">(N·ªìng ƒë·ªô mu·ªëi b√™n ngo√†i cao h∆°n n·ªìng ƒë·ªô ch·∫•t tan trong t·∫ø b√†o).</p></div></li>
                                <li class="flex gap-4 items-start"><div class="bg-orange-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0 shadow-md mt-1">2</div><div><p class="text-lg text-slate-800">N∆∞·ªõc di chuy·ªÉn t·ª´ <strong>trong t·∫ø b√†o</strong> (th·∫ø n∆∞·ªõc cao) ra <strong>ngo√†i m√¥i tr∆∞·ªùng</strong> (th·∫ø n∆∞·ªõc th·∫•p).</p></div></li>
                                <li class="flex gap-4 items-start"><div class="bg-orange-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0 shadow-md mt-1">3</div><div><p class="text-lg text-slate-800">K·∫øt qu·∫£: T·∫ø b√†o rau b·ªã m·∫•t n∆∞·ªõc n√™n <strong>teo l·∫°i</strong>. ƒê·ªìng th·ªùi ƒë∆∞·ªùng v√† ch·∫•t dinh d∆∞·ª°ng ƒëi ra ngo√†i t·∫°o ƒëi·ªÅu ki·ªán cho vi khu·∫©n lactic l√™n men g√¢y chua.</p></div></li>
                            </ul>
                        </div>
                        <div class="mt-8 text-center"><button onclick="toggleApplySlide(1)" class="text-slate-500 font-bold hover:text-orange-600 hover:underline flex items-center gap-2 mx-auto transition-colors">‚¨ÖÔ∏è Quay l·∫°i hi·ªán t∆∞·ª£ng</button></div>
                    </div>
                </div>
            </section>
            
            <div class="h-12"></div>
            
            <!-- Copyright -->
            <div class="text-center pb-8 text-emerald-800/40 text-sm font-bold tracking-widest uppercase">
                Design by Fubao
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        function showSection(id) {
            document.querySelectorAll('#main-content > div > section').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            const target = document.getElementById('sec-' + id);
            target.classList.remove('hidden');
            target.classList.remove('animate-[float_0.5s_ease-out]');
            void target.offsetWidth; 
            target.classList.add('animate-[float_0.5s_ease-out]');
            if(id === 'lab') { target.classList.remove('hidden'); target.classList.add('flex'); } else { target.classList.remove('flex'); }
            if (id !== 'apply') { toggleApplySlide(1); }
            document.getElementById('btn-' + id).classList.add('active');
        }

        // --- Tab Switcher Logic ---
        function switchLabTab(tab) {
            const tabs = ['diffusion', 'osmosis-basic', 'osmosis-cell'];
            tabs.forEach(t => {
                const btn = document.getElementById('tab-' + t);
                const content = document.getElementById('lab-' + t);
                if(t === tab) {
                    btn.classList.add('active', 'text-teal-700', 'bg-teal-100', 'border-teal-200');
                    btn.classList.remove('text-gray-500');
                    content.classList.remove('hidden');
                    if (tab === 'diffusion') resetDiffusion();
                    if (tab === 'osmosis-basic') resetOsmosisBasic();
                } else {
                    btn.classList.remove('active', 'text-teal-700', 'bg-teal-100', 'border-teal-200');
                    btn.classList.add('text-gray-500');
                    content.classList.add('hidden');
                }
            });
        }

        // --- 1. Diffusion Logic ---
        function resetDiffusion() {
            const container = document.getElementById('diffusion-particles');
            container.innerHTML = '';
            
            // Reset Labels
            document.getElementById('diff-label-left').innerText = "N·ªìng ƒë·ªô Cao";
            document.getElementById('diff-label-left').className = "absolute bottom-2 text-white/50 text-xs font-bold uppercase transition-all";
            document.getElementById('diff-label-right').innerText = "N·ªìng ƒë·ªô Th·∫•p";
            document.getElementById('diff-label-right').className = "absolute bottom-2 text-white/50 text-xs font-bold uppercase transition-all";

            // Create particles
            for(let i=0; i<30; i++) {
                const dot = document.createElement('div');
                dot.className = 'molecule-particle static-jitter absolute w-3 h-3 bg-green-400 rounded-full shadow-sm border border-white/30 transition-all duration-[4s] ease-in-out z-20';
                const left = Math.random() * 45; 
                const top = Math.random() * 90 + 5; 
                dot.style.left = left + '%';
                dot.style.top = top + '%';
                dot.style.animationDelay = Math.random() + 's';
                container.appendChild(dot);
            }
        }

        function runDiffusion() {
            const dots = document.getElementById('diffusion-particles').children;
            for(let i=0; i<dots.length; i++) {
                const targetLeft = Math.random() * 95; 
                const targetTop = Math.random() * 90 + 5;
                dots[i].style.left = targetLeft + '%';
                dots[i].style.top = targetTop + '%';
            }
            setTimeout(() => {
                const lblLeft = document.getElementById('diff-label-left');
                const lblRight = document.getElementById('diff-label-right');
                lblLeft.innerText = "C√¢n b·∫±ng n·ªìng ƒë·ªô";
                lblLeft.className = "absolute bottom-2 text-green-300 text-xs font-bold uppercase transition-all scale-110";
                lblRight.innerText = "C√¢n b·∫±ng n·ªìng ƒë·ªô";
                lblRight.className = "absolute bottom-2 text-green-300 text-xs font-bold uppercase transition-all scale-110";
            }, 4000);
        }

        // --- 2. Osmosis Basic (Beaker) Logic ---
        function resetOsmosisBasic() {
            document.getElementById('water-left-beaker').style.height = '150px';
            document.getElementById('water-right-beaker').style.height = '150px';
            document.getElementById('osmosis-arrow').style.opacity = '0';
            drawBeakerMolecules(); // redraw random dots
        }
        function runOsmosisBasic() {
            document.getElementById('water-left-beaker').style.height = '80px'; 
            document.getElementById('water-right-beaker').style.height = '220px'; 
            document.getElementById('osmosis-arrow').style.opacity = '1';
        }
        function drawBeakerMolecules() {
            // Draw random floating dots instead of packed ones
            const leftContainer = document.getElementById('solutes-left-beaker');
            const rightContainer = document.getElementById('solutes-right-beaker');
            leftContainer.innerHTML = ''; rightContainer.innerHTML = '';

            // Left: Low conc (e.g., 5 dots)
            for(let i=0; i<5; i++) {
                const dot = document.createElement('div');
                dot.className = 'absolute w-3 h-3 bg-green-400 rounded-full shadow-sm static-jitter';
                dot.style.left = Math.random() * 80 + 10 + '%';
                dot.style.top = Math.random() * 80 + 10 + '%'; // Relative to container height
                dot.style.animationDelay = Math.random() + 's';
                leftContainer.appendChild(dot);
            }
            // Right: High conc (e.g., 20 dots)
            for(let i=0; i<20; i++) {
                const dot = document.createElement('div');
                dot.className = 'absolute w-3 h-3 bg-green-400 rounded-full shadow-sm static-jitter';
                dot.style.left = Math.random() * 80 + 10 + '%';
                dot.style.top = Math.random() * 80 + 10 + '%';
                dot.style.animationDelay = Math.random() + 's';
                rightContainer.appendChild(dot);
            }
        }

        // --- 3. Osmosis Cell Logic ---
        function runLab(type) {
            const cellWrapper = document.getElementById('cell-wrapper');
            const cellNormal = document.getElementById('cell-normal');
            const cellCrenated = document.getElementById('cell-crenated-bg');
            const resultBox = document.getElementById('lab-result');
            
            // Reset
            cellWrapper.style.animation = 'none';
            cellWrapper.style.transform = 'scale(1)';
            cellWrapper.style.opacity = '1';
            cellWrapper.style.display = 'flex';
            cellNormal.style.display = 'flex';
            cellCrenated.style.display = 'none';
            cellCrenated.classList.remove('cell-crenated');
            void cellWrapper.offsetWidth;
            
            resultBox.classList.remove('hidden');
            
            // Draw molecules initially
            drawMolecules(type); 
            drawArrows(type);

            // Animate Existing Molecules after a slight delay
            setTimeout(() => {
                animateExistingMolecules(type);
            }, 100);

            if(type === 'hyper') {
                cellWrapper.style.animation = 'morph-shrink 6s forwards';
                setTimeout(() => {
                    cellNormal.style.display = 'none';
                    cellCrenated.style.display = 'block';
                    cellCrenated.classList.add('cell-crenated'); 
                }, 5800); 
                resultBox.innerHTML = "<strong class='text-orange-300 block mb-1'>∆Øu tr∆∞∆°ng (Hypertonic):</strong><br> - Ngo√†i: Nhi·ªÅu Ch·∫•t tan.<br> - Trong: Nhi·ªÅu N∆∞·ªõc.<br> ‚ûî N∆∞·ªõc ƒëi RA ‚ûî T·∫ø b√†o teo l·∫°i.";
                resultBox.className = "mt-auto p-4 rounded-xl bg-slate-800 border-l-4 border-orange-500 text-white text-sm shadow-lg";
            } else if(type === 'iso') {
                resultBox.innerHTML = "<strong class='text-green-300 block mb-1'>ƒê·∫≥ng tr∆∞∆°ng (Isotonic):</strong><br> C√¢n b·∫±ng.<br> ‚ûî N∆∞·ªõc ra/v√†o nh∆∞ nhau ‚ûî T·∫ø b√†o b√¨nh th∆∞·ªùng.";
                resultBox.className = "mt-auto p-4 rounded-xl bg-slate-800 border-l-4 border-green-500 text-white text-sm shadow-lg";
            } else if(type === 'hypo') {
                cellWrapper.style.animation = 'swell-burst 6s forwards';
                resultBox.innerHTML = "<strong class='text-blue-300 block mb-1'>Nh∆∞·ª£c tr∆∞∆°ng (Hypotonic):</strong><br> - Ngo√†i: Nhi·ªÅu N∆∞·ªõc.<br> - Trong: Nhi·ªÅu Ch·∫•t tan.<br> ‚ûî N∆∞·ªõc ƒëi V√ÄO ‚ûî T·∫ø b√†o tr∆∞∆°ng l√™n v√† V·ª†.";
                resultBox.className = "mt-auto p-4 rounded-xl bg-slate-800 border-l-4 border-blue-500 text-white text-sm shadow-lg";
            }
        }

        // Shared Utils for Cell Lab
        function drawArrows(type) {
            const container = document.getElementById('arrows-container');
            container.innerHTML = '';
            if (type === 'iso') return; 
            const arrowCount = 6;
            const isOut = type === 'hyper'; 
            for(let i=0; i<arrowCount; i++) {
                const angle = (360 / arrowCount) * i;
                const arrowEl = document.createElement('div');
                arrowEl.className = 'absolute flex items-center justify-center';
                arrowEl.style.transform = `rotate(${angle}deg) translateY(-140px)`; 
                arrowEl.style.opacity = '0.8';
                const directionTransform = isOut ? 'rotate(180deg)' : 'rotate(0deg)'; 
                arrowEl.innerHTML = `<svg width="40" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="transform: ${directionTransform}"><path d="M12 4L12 20M12 20L6 14M12 20L18 14" stroke="rgba(255,255,255,0.7)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
                arrowEl.animate([{ opacity: 0, transform: `rotate(${angle}deg) translateY(${isOut ? '-120px' : '-160px'})` }, { opacity: 1, transform: `rotate(${angle}deg) translateY(-140px)` }, { opacity: 0, transform: `rotate(${angle}deg) translateY(${isOut ? '-160px' : '-120px'})` }], { duration: 2000, iterations: Infinity, delay: i * 200, easing: 'ease-in-out' });
                container.appendChild(arrowEl);
            }
        }

        function drawMolecules(type) {
            const container = document.getElementById('molecules-layer'); 
            container.innerHTML = ''; 
            
            let outCounts = [0, 0]; let inCounts = [0, 0];
            if(type === 'hyper') { 
                outCounts = [5, 8]; inCounts = [2, 12]; 
            } 
            else if(type === 'iso') { 
                outCounts = [4, 7]; inCounts = [4, 7]; 
            } 
            else if(type === 'hypo') { 
                outCounts = [3, 20]; inCounts = [10, 5]; 
            }
            
            const placedPositions = [];
            const getPos = (isInside, particleRadius) => {
                let maxTries = 100; // S·ªë l·∫ßn th·ª≠ t√¨m v·ªã tr√≠ tr·ªëng t·ªëi ƒëa
                let bestPos = {x: 50, y: 50};
                let foundSafe = false;

                while(maxTries > 0 && !foundSafe) {
                    const angle = Math.random() * Math.PI * 2;
                    let r;
                    if(isInside) {
                        r = Math.random() * 15; // B√™n trong (g·∫ßn t√¢m)
                    } else {
                        r = 30 + Math.random() * 15; // B√™n ngo√†i
                    }
                    const x = 50 + r * Math.cos(angle);
                    const y = 50 + r * Math.sin(angle);
                    let collision = false;
                    for (let p of placedPositions) {
                        const dx = x - p.x;
                        const dy = y - p.y;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        const minSafeDist = particleRadius + p.radius + 3; 
                        if (dist < minSafeDist) {
                            collision = true;
                            break;
                        }
                    }
                    if (!collision) {
                        bestPos = {x, y};
                        foundSafe = true;
                    }
                    maxTries--;
                }
                return bestPos;
            };

            const spawn = (count, moleculeType, isInside) => {
                const pRadius = moleculeType === 'solute' ? 4 : 2;
                for(let i=0; i<count; i++) {
                    const dot = document.createElement('div');
                    dot.className = `molecule-particle absolute rounded-full static-jitter`;
                    if(moleculeType === 'solute') { 
                        dot.classList.add('bg-green-400', 'w-6', 'h-6', 'shadow-sm'); 
                    } else { 
                        dot.classList.add('bg-blue-400', 'w-3', 'h-3'); 
                    } 
                    const pos = getPos(isInside, pRadius);
                    placedPositions.push({x: pos.x, y: pos.y, radius: pRadius});
                    dot.style.left = pos.x + '%';
                    dot.style.top = pos.y + '%';
                    dot.dataset.loc = isInside ? 'in' : 'out';
                    dot.dataset.type = moleculeType; 
                    container.appendChild(dot);
                }
            };
            spawn(outCounts[0], 'solute', false); 
            spawn(inCounts[0], 'solute', true); 
            spawn(outCounts[1], 'water', false); 
            spawn(inCounts[1], 'water', true);
        }

        function animateExistingMolecules(type) {
            const particles = document.querySelectorAll('.molecule-particle');
            
            if (window.isoInterval) {
                clearInterval(window.isoInterval);
                window.isoInterval = null;
            }

            if (type === 'iso') {
                window.isoInterval = setInterval(() => {
                    const allParticles = Array.from(document.querySelectorAll('.molecule-particle'));
                    
                    const waterIn = allParticles.filter(p => p.dataset.type === 'water' && p.dataset.loc === 'in');
                    const waterOut = allParticles.filter(p => p.dataset.type === 'water' && p.dataset.loc === 'out');
                    const soluteIn = allParticles.filter(p => p.dataset.type === 'solute' && p.dataset.loc === 'in');
                    const soluteOut = allParticles.filter(p => p.dataset.type === 'solute' && p.dataset.loc === 'out');

                    const moveParticle = (p, targetLoc) => {
                        if (!p) return;
                        const angle = Math.random() * Math.PI * 2;
                        let r;
                        if (targetLoc === 'in') { r = Math.random() * 18; } 
                        else { r = 30 + Math.random() * 15; }
                        const x = 50 + r * Math.cos(angle);
                        const y = 50 + r * Math.sin(angle);
                        p.style.left = x + '%';
                        p.style.top = y + '%';
                        p.dataset.loc = targetLoc; 
                    };

                    if (Math.random() > 0.3 && waterIn.length > 0 && waterOut.length > 0) {
                        const pIn = waterIn[Math.floor(Math.random() * waterIn.length)];
                        const pOut = waterOut[Math.floor(Math.random() * waterOut.length)];
                        moveParticle(pIn, 'out');
                        moveParticle(pOut, 'in');
                    }

                    if (Math.random() > 0.6 && soluteIn.length > 0 && soluteOut.length > 0) {
                        const pIn = soluteIn[Math.floor(Math.random() * soluteIn.length)];
                        const pOut = soluteOut[Math.floor(Math.random() * soluteOut.length)];
                        moveParticle(pIn, 'out');
                        moveParticle(pOut, 'in');
                    }
                }, 1500); 
                return;
            }

            // Hyper / Hypo logic
            particles.forEach(p => {
                if(p.dataset.type !== 'water') return; 
                
                if(type === 'hyper' && p.dataset.loc === 'in') {
                    const angle = Math.random() * Math.PI * 2;
                    const r = 30 + Math.random() * 15; 
                    const x = 50 + r * Math.cos(angle);
                    const y = 50 + r * Math.sin(angle);
                    p.style.left = x + '%'; p.style.top = y + '%'; p.style.opacity = 0; 
                }
                else if(type === 'hypo' && p.dataset.loc === 'out') {
                    const angle = Math.random() * Math.PI * 2;
                    const r = Math.random() * 15; 
                    const x = 50 + r * Math.cos(angle);
                    const y = 50 + r * Math.sin(angle);
                    p.style.left = x + '%'; p.style.top = y + '%'; p.style.opacity = 0; 
                }
            });
        }

        function toggleObservation(id) {
            const el = document.getElementById('obs-' + id);
            el.classList.remove('hidden'); el.classList.add('animate-pulse');
            setTimeout(() => el.classList.remove('animate-pulse'), 1000);
            if(id === 'bowl2') { document.getElementById('salt-slice').style.transform = "scale(0.85) rotate(15deg)"; }
        }

        // Re-added toggleApplySlide function
        function toggleApplySlide(slideNum) {
            const s1 = document.getElementById('apply-slide-1');
            const s2 = document.getElementById('apply-slide-2');
            if(slideNum === 1) { 
                s2.classList.add('hidden'); 
                s1.classList.remove('hidden'); 
                s1.classList.remove('animate-[float_0.5s_ease-out]'); 
                void s1.offsetWidth; 
                s1.classList.add('animate-[float_0.5s_ease-out]'); 
            } else { 
                s1.classList.add('hidden'); 
                s2.classList.remove('hidden'); 
                s2.classList.remove('animate-[float_0.5s_ease-out]'); 
                void s2.offsetWidth; 
                s2.classList.add('animate-[float_0.5s_ease-out]'); 
            }
        }

        function checkQuiz() {
            const answers = { q1: 'cao', q2: 'th·∫•p', q3: 'th·ª• ƒë·ªông', q4: 'nh∆∞·ª£c tr∆∞∆°ng', q5: '∆∞u tr∆∞∆°ng' };
            let score = 0; let total = 5;
            for (let id in answers) { const userVal = document.getElementById(id).value; const el = document.getElementById(id); if (userVal === answers[id]) { score++; el.classList.add('bg-green-100', 'text-green-800', 'border-green-400'); el.classList.remove('bg-red-100', 'text-red-800', 'border-red-400'); } else { el.classList.add('bg-red-100', 'text-red-800', 'border-red-400'); el.classList.remove('bg-green-100', 'text-green-800', 'border-green-400'); } }
            const fbBox = document.getElementById('quiz-feedback'); fbBox.classList.remove('hidden');
            if(score === total) { fbBox.innerHTML = `üéâ Xu·∫•t s·∫Øc! ${score}/${total} c√¢u ƒë√∫ng.`; fbBox.className = "text-sm font-bold px-4 py-2 rounded-lg bg-green-100 text-green-700 border border-green-200"; } else { fbBox.innerHTML = `üí™ C·ªë l√™n! ${score}/${total} c√¢u ƒë√∫ng.`; fbBox.className = "text-sm font-bold px-4 py-2 rounded-lg bg-orange-100 text-orange-700 border border-orange-200"; }
        }
        
        // Init with Diffusion
        showSection('intro');
        resetDiffusion();
        drawBeakerMolecules(); // Init beaker molecules
    </script>
</body>
</html>
