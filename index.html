<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nền tảng Bài tập Sáng tạo NDS</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Thêm font Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Sử dụng font Inter làm mặc định */
        body { 
            font-family: 'Inter', sans-serif; 
        }
        /* Ẩn tất cả các trang nội dung theo mặc định */
        .page-content { 
            display: none; 
        }
        /* Hiển thị trang đang hoạt động */
        .page-content.active { 
            display: block; 
        }
        /* Kiểu cho link điều hướng đang hoạt động */
        .nav-link.active {
            background-color: #4338CA; /* indigo-700 */
            color: white;
            font-weight: 600;
        }

        /* Định nghĩa lớp answer-box */
        .answer-box {
            margin-top: 0.5rem;
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #D1D5DB; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
        }
        .answer-box:focus {
            box-shadow: 0 0 0 2px #C7D2FE; /* focus:ring-indigo-500 */
        }

        /* --- CSS cho Modal và Spinner (Tính năng Gemini) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: none; /* Ẩn theo mặc định */
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        .modal-overlay.active {
            display: flex; /* Hiển thị khi active */
        }
        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827; /* text-gray-900 */
        }
        .modal-body {
            margin-top: 1rem;
            font-size: 0.875rem;
            color: #374151; /* text-gray-700 */
            white-space: pre-wrap; /* Giữ nguyên định dạng xuống dòng */
            background-color: #F9FAFB; /* bg-gray-50 */
            padding: 1rem;
            border-radius: 0.375rem;
            border: 1px solid #E5E7EB; /* border-gray-200 */
        }
        .modal-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #E5E7EB; /* border-gray-200 */
            border-top-color: #4F46E5; /* indigo-600 */
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* --- Hết CSS cho Modal --- */

        /* Kiểu CSS cho bản in */
        @media print {
            body {
                font-family: 'Times New Roman', Times, serif;
                font-size: 12pt;
                color: #000;
            }
            /* Ẩn thanh điều hướng và nút in */
            nav, .print-exercise-button {
                display: none !important;
            }
            main {
                padding: 0 !important;
                margin: 0 !important;
                width: 100% !important;
            }
            /* Ẩn TẤT CẢ các trang theo mặc định khi in */
            .page-content {
                display: none !important;
            }
            /* CHỈ HIỂN THỊ trang đang 'active' khi in */
            .page-content.active {
                display: block !important;
                page-break-before: auto !important; /* Không ngắt trang trước */
            }
            /* Reset styles cho gọn gàng */
            .bg-white, .bg-gray-100 {
                background-color: #fff !important;
            }
            .shadow-md {
                box-shadow: none !important;
                border: 1px solid #eee !important;
            }
            h1, h2, h3 {
                color: #000 !important;
            }
            .text-indigo-700, .text-green-700, .text-gray-700, .text-gray-900, .text-gray-600 {
                color: #000 !important;
            }
            a {
                text-decoration: none;
                color: #000;
            }
            table, th, td {
                border: 1px solid #ccc !important;
                page-break-inside: avoid;
            }
            ul, p, div {
                page-break-inside: avoid;
            }
            /* Đảm bảo ô trả lời hiển thị rõ ràng */
            .answer-box {
                border: 1px dashed #999 !important;
                background-color: #f9f9f9 !important;
                page-break-inside: avoid;
                /* Hiển thị nội dung của textarea khi in */
                overflow: visible !important;
                height: auto !important;
            }
            /* Ẩn các chi tiết không cần thiết */
            #q2-a-details.hidden, #q2-b-details.hidden {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex flex-col md:flex-row min-h-screen">
        
        <!-- Thanh điều hướng bên (Sidebar) -->
        <nav class="w-full md:w-72 bg-indigo-800 text-white p-5 space-y-3 shrink-0 flex flex-col">
            <div>
                <h1 class="text-2xl font-bold mb-6 text-center">
                    Năng lực Sáng tạo NDS
                </h1>
                <a href="#" class="nav-link active block p-3 rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors duration-200" data-target="page-home">
                    Trang chủ
                </a>
                <a href="#" class="nav-link block p-3 rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors duration-200" data-target="page-bt1">
                    Bài tập 1: Phát triển NDS
                </a>
                <a href="#" class="nav-link block p-3 rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors duration-200" data-target="page-bt2">
                    Bài tập 2: Tích hợp & Tái lập
                </a>
                <a href="#" class="nav-link block p-3 rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors duration-200" data-target="page-bt3">
                    Bài tập 3: Lập trình
                </a>
            </div>
            <!-- Nút In / Xuất PDF (ĐÃ XÓA KHỎI ĐÂY) -->
        </nav>

        <!-- Khu vực nội dung chính -->
        <main class="flex-1 p-6 md:p-10 overflow-auto">

            <!-- Trang: Trang chủ -->
            <div id="page-home" class="page-content active space-y-6">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">
                    Chào mừng đến với Nền tảng Bài tập
                </h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <p class="text-lg text-gray-700 leading-relaxed">
                        Đây là nền tảng web được thiết kế để hỗ trợ bạn thực hành các bài tập phát triển năng lực sáng tạo nội dung số (NDS).
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-4">
                        Mỗi bài tập được xây dựng theo cấu trúc 4 giai đoạn:
                    </p>
                    <ul class="list-decimal list-inside text-gray-700 mt-4 space-y-2">
                        <li><strong>Trải nghiệm cụ thể (Tình huống sư phạm):</strong> Đặt ra bối cảnh thực tiễn.</li>
                        <li><strong>Quan sát phản tư (Thiết lập nền tảng):</strong> Thiết kế nhiệm vụ để phát triển năng lực.</li>
                        <li><strong>Trừu tượng hóa (Nhiệm vụ kiến tạo):</strong> Thiết kế khung nội dung/kế hoạch cho sản phẩm.</li>
                        <li><strong>Thử nghiệm tích cực (Thử thách sáng tạo):</strong> Vận dụng kiến thức để phát triển sản phẩm.</li>
                    </ul>
                    <p class="text-gray-700 leading-relaxed mt-4">
                        Sử dụng thanh điều hướng bên trái để chọn bài tập bạn muốn thực hiện.
                    </p>
                </div>
            </div>

            <!-- Trang: Bài tập 1 -->
            <div id="page-bt1" class="page-content space-y-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-3xl font-bold text-gray-800">Bài tập 1: Phát triển Năng lực Phát triển Nội dung số</h2>
                    <a href="#" class="print-exercise-button p-3 rounded-lg text-sm font-medium bg-green-600 text-white text-center hover:bg-green-700 transition-colors duration-200">
                        In Bài 1 / Xuất PDF
                    </a>
                </div>
                
                <!-- Phần 1: Tình huống sư phạm -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Phần 1: Tình huống sư phạm</h3>
                    <p class="text-gray-700 leading-relaxed">
                        Là một GVBM Sinh học tại trường THPT A, tham gia cuộc thi “Thiết kế bài giảng E – learning năm học 2025-2026” và nhận chủ đề thiết kế bài giảng thuộc chương trình sinh học 10. Bạn đang đứng trước các vấn đề: E-learning có những ưu việt gì so với bài giảng truyền thống? Làm thế nào để thiết kế một bài giảng E-learning có tính tương tác cao, giúp học sinh tự khám phá, thao tác và hiểu sâu kiến thức Sinh học thông qua các công cụ số phù hợp?
                    </p>
                </div>
                
                <!-- Phần 2: Thiết lập nền tảng -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Phần 2: Thiết lập nền tảng</h3>
                    <div class="space-y-4 text-gray-700">
                        <div>
                            <p><strong>1. Xác định mục tiêu nội dung/chủ đề cho bài giảng E – learning?</strong></p>
                            <!-- Thêm ID để JS có thể lấy giá trị -->
                            <textarea id="bt1-q1-answer" class="answer-box" rows="3" placeholder="Nhập câu trả lời của bạn..."></textarea>
                        </div>
                        <p><strong>2. Có thể áp dụng công cụ nào để nhận thấy e – learning góp phần nâng cao hiệu quả dạy học chủ đề đã chọn so với bài giảng truyền thống?</strong></p>
                        <div class="ml-5 space-y-2 mt-2">
                            <div class="flex items-center">
                                <input id="bt1-q2-a" name="bt1-q2" type="radio" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <label for="bt1-q2-a" class="ml-3 block text-gray-900">a) Khảo sát (thu nhận phản hồi từ người học)</label>
                            </div>
                            <div class="flex items-center">
                                <input id="bt1-q2-b" name="bt1-q2" type="radio" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                <label for="bt1-q2-b" class="ml-3 block text-gray-900">b) Bài kiểm tra cuối khóa</label>
                            </div>
                        </div>
                        <p><strong>3. Xác định phương tiện/công nghệ số mà bạn có thể sử dụng thành thạo để thiết kế các nội dung số cho e – learning?</strong></p>
                        <div class="space-y-2 ml-5 text-gray-700 mt-2">
                            <!-- Checkboxes -->
                            <div class="flex items-center">
                                <input id="bt1-tool-canva" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="bt1-tool-canva" class="ml-3 block text-gray-900">Canva/ Power Point</label>
                            </div>
                            <div class="flex items-center">
                                <input id="bt1-tool-gpt" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="bt1-tool-gpt" class="ml-3 block text-gray-900">GPT/Gemini</label>
                            </div>
                            <div class="flex items-center">
                                <input id="bt1-tool-powtoon" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="bt1-tool-powtoon" class="ml-3 block text-gray-900">Powtoon/Prezi</label>
                            </div>
                            <div class="flex items-center">
                                <input id="bt1-tool-docs" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="bt1-tool-docs" class="ml-3 block text-gray-900">Google docs/word</label>
                            </div>
                            <div class="flex items-center">
                                <input id="bt1-tool-draw" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="bt1-tool-draw" class="ml-3 block text-gray-900">Draw/ App đồ họa</label>
                            </div>
                            <div class="flex items-center">
                                <input id="bt1-tool-kahoot" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="bt1-tool-kahoot" class="ml-3 block text-gray-900">Kahoot</label>
                            </div>
                            <div class="flex items-center">
                                <input id="bt1-tool-leoai" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="bt1-tool-leoai" class="ml-3 block text-gray-900">Leonardo AI</label>
                            </div>
                            <div class="flex items-center">
                                <input id="bt1-tool-other" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="bt1-tool-other" class="ml-3 block text-gray-900">Khác</label>
                            </div>
                        </div>
                        <div>
                            <p><strong>4. Thời gian hoàn thành E-learning?</strong></p>
                            <textarea class="answer-box" rows="2" placeholder="Nhập câu trả lời của bạn..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Phần 3: Nhiệm vụ kiến tạo -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Phần 3: Nhiệm vụ kiến tạo</h3>
                    <p class="text-gray-700 mb-4">Theo kết quả phân tích các yêu cầu ở phần thiết lập nền tảng, lập kế hoạch thiết kế e – learning theo KHBD theo hướng dẫn bên dưới:</p>

                    <!-- NÚT TÍCH HỢP GEMINI API -->
                    <div class="my-4">
                        <button id="gemini-suggest-plan-btn" class="flex items-center justify-center gap-2 w-full px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors duration-200">
                            ✨ Gợi ý Kế hoạch E-learning (với Gemini)
                        </button>
                    </div>

                    <div class="overflow-x-auto mt-4">
                        <table class="min-w-full divide-y divide-gray-200 border">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Yêu cầu</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hướng dẫn</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200 text-gray-700">
                                <tr>
                                    <td class="px-6 py-4 font-medium">Phân tích cấu trúc kế hoạch dạy học</td>
                                    <td class="px-6 py-4">"Xác định: mục tiêu bài học? nội dung trọng tâm? hình thức tổ chức (trực tiếp, trực tuyến, kết hợp)?"</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 font-medium">Xác định vai trò của nội dung số trong từng hoạt động học</td>
                                    <td class="px-6 py-4">
                                        <ul class="list-disc list-inside">
                                            <li>Hoạt động khởi động: sử dụng video, hình ảnh, câu hỏi gợi mở.</li>
                                            <li>Hoạt động hình thành/khám phá kiến thức: video – bải giảng tương tác</li>
                                            <li>Hoạt động luyện tập/đánh giá: quiz, trò chơi, bài tập tương tác</li>
                                        </ul>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 font-medium">"Xác định thời gian, nguồn lực và công cụ số"</td>
                                    <td class="px-6 py-4">"Lập kế hoạch chi tiết cho từng loại nội dung: thời lượng, công cụ (Canva, H5P, ..)"</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 font-medium">Tìm hiểu về H5P</td>
                                    <td class="px-6 py-4"><a href="https://drive.google.com/file/d/1HdthPJHYe4EdaG4PBbiB6nP6ztCslysk/view?usp=sharing" target="_blank" class="text-blue-600 hover:underline">Link tài liệu H5P</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Phần 4: Thử thách sáng tạo -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Phần 4: Thử thách sáng tạo</h3>
                    <p class="text-gray-700 leading-relaxed">
                        Tham khảo tài liệu hưởng dẫn để sử dụng H5P để tạo E – learning triển khai KHBD và kế hoạch thiết kế E – learning đã hoàn thành ở phần kiến tạo.
                    </p>
                    <!-- Bổ sung ô nhập link sản phẩm -->
                    <div class="mt-4">
                        <p class="text-gray-700 font-medium">Sản phẩm: Nộp lại 01 đường link (URL) sản phẩm E-learning H5P hoàn chỉnh.</p>
                        <input type="text" class="answer-box" placeholder="Dán đường link (URL) sản phẩm H5P của bạn tại đây...">
                    </div>
                </div>
            </div>

            <!-- Trang: Bài tập 2 (ĐÃ KHÔI PHỤC) -->
            <div id="page-bt2" class="page-content space-y-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-3xl font-bold text-gray-800">Bài tập 2: Tích hợp & Tái lập nội dung số</h2>
                    <a href="#" class="print-exercise-button p-3 rounded-lg text-sm font-medium bg-green-600 text-white text-center hover:bg-green-700 transition-colors duration-200">
                        In Bài 2 / Xuất PDF
                    </a>
                </div>

                <!-- Phần 1: Tình huống sư phạm -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Phần 1: Tình huống sư phạm</h3>
                    <p class="text-gray-700 leading-relaxed">
                        Bạn đang cần tổ chức hoạt động học cho học sinh tích hợp kiến thức của 2 chủ đề (Ví dụ: Trao đổi chất và Năng lượng + Ứng dụng công nghệ sinh học) bằng việc tái lập nội dung số. Bạn có thể sử dụng công cụ số nào để tích hợp 2 chủ đề này? Làm thế nào để đảm bảo học sinh có thể tự thao tác và thực hành với nội dung tích hợp này?
                    </p>
                </div>

                <!-- Phần 2: Thiết lập nền tảng -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Phần 2: Thiết lập nền tảng</h3>
                    <div class="space-y-4 text-gray-700">
                        <div>
                            <p><strong>1. Xác định hình thức học liệu tích hợp sẽ thực hiện?</strong></p>
                            <div class="ml-5 space-y-2 mt-2">
                                <div class="flex items-center">
                                    <input id="q1-flipbook" name="hoc-lieu-type" type="radio" value="flipbook" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                    <label for="q1-flipbook" class="ml-3 block text-gray-900">a) Flipbook (Sách điện tử tương tác)</label>
                                }
                                <div class="flex items-center">
                                    <input id="q1-website" name="hoc-lieu-type" type="radio" value="website" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                    <label for="q1-website" class="ml-3 block text-gray-900">b) Website (Trang web nội dung)</label>
                                </div>
                            </div>
                        </div>

                        <div>
                            <p><strong>2. Xác định công cụ sẽ sử dụng để tái lập nội dung số?</strong></p>
                            <div class="ml-5 space-y-2 mt-2">
                                <div class="flex items-center">
                                    <input id="q2-a-flipbook" name="tool-type" type="radio" value="flipbook-tool" disabled class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                    <label for="q2-a-flipbook" class="ml-3 block text-gray-500 cursor-not-allowed">a) Dùng phần mềm tạo Flipbook (Ví dụ: FlipHTML5, PubHTML5)</label>
                                </div>
                                <div id="q2-a-details" class="ml-10 hidden bg-gray-50 p-3 rounded-lg border border-gray-200 text-sm mt-1">
                                    <p class="font-medium">Ưu điểm:</p>
                                    <textarea class="answer-box" rows="2" placeholder="Ưu điểm của công cụ tạo Flipbook..."></textarea>
                                    <p class="font-medium mt-2">Hạn chế:</p>
                                    <textarea class="answer-box" rows="2" placeholder="Hạn chế của công cụ tạo Flipbook..."></textarea>
                                </div>

                                <div class="flex items-center">
                                    <input id="q2-b-website" name="tool-type" type="radio" value="website-tool" disabled class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                    <label for="q2-b-website" class="ml-3 block text-gray-500 cursor-not-allowed">b) Dùng công cụ lập trình web (Ví dụ: HTML, CSS, Javascript)</label>
                                </div>
                                <div id="q2-b-details" class="ml-10 hidden bg-gray-50 p-3 rounded-lg border border-gray-200 text-sm mt-1">
                                    <p class="font-medium">Ưu điểm:</p>
                                    <textarea class="answer-box" rows="2" placeholder="Ưu điểm của công cụ lập trình web..."></textarea>
                                    <p class="font-medium mt-2">Hạn chế:</p>
                                    <textarea class="answer-box" rows="2" placeholder="Hạn chế của công cụ lập trình web..."></textarea>
                                </div>
                            </div>
                        </div>

                        <div>
                            <p><strong>3. Xác định thời gian hoàn thành?</strong></p>
                            <textarea class="answer-box" rows="2" placeholder="Nhập câu trả lời của bạn..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Phần 3: Nhiệm vụ kiến tạo -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Phần 3: Nhiệm vụ kiến tạo</h3>
                    <p class="text-gray-700 mb-4">Lập kế hoạch thiết kế và tái lập nội dung số theo hướng dẫn:</p>
                    <div class="overflow-x-auto mt-4">
                        <table class="min-w-full divide-y divide-gray-200 border">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/3">Yêu cầu</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/3">Kế hoạch chi tiết</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200 text-gray-700">
                                <tr>
                                    <td class="px-6 py-4 font-medium align-top">Xác định cấu trúc nội dung</td>
                                    <td class="px-6 py-2">
                                        <textarea class="answer-box" rows="3" placeholder="Liệt kê các chủ đề/mục tiêu kiến thức cần tích hợp và tái lập (cấu trúc của nội dung số)"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 font-medium align-top">Xác định vai trò của nội dung số</td>
                                    <td class="px-6 py-2">
                                        <textarea class="answer-box" rows="3" placeholder="Mô tả cách nội dung được tái lập sẽ giúp HS khám phá/thực hành kiến thức tích hợp"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 font-medium align-top">"Xác định nguồn lực, công cụ"</td>
                                    <td class="px-6 py-2">
                                        <textarea class="answer-box" rows="3" placeholder="Liệt kê tài liệu tham khảo, công cụ số (tạo hình ảnh, video, âm thanh...)"></textarea>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Phần 4: Thử thách sáng tạo -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Phần 4: Thử thách sáng tạo</h3>
                    <p class="text-gray-700 leading-relaxed">
                        Theo kế hoạch đã lập, thiết kế sản phẩm nội dung số tích hợp (Flipbook hoặc Website) và nộp lại link.
                    </p>
                    <div class="mt-4">
                        <p class="text-gray-700 font-medium">Sản phẩm: Nộp lại 01 đường link (URL) sản phẩm nội dung số tích hợp hoàn chỉnh.</p>
                        <input type="text" class="answer-box" placeholder="Dán đường link (URL) sản phẩm của bạn tại đây...">
                        <textarea class="answer-box mt-4" rows="5" placeholder="Viết đoạn phản tư của bạn về sản phẩm..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Trang: Bài tập 3 (ĐÃ KHÔI PHỤC) -->
            <div id="page-bt3" class="page-content space-y-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-3xl font-bold text-gray-800">Bài tập 3: Lập trình</h2>
                    <a href="#" class="print-exercise-button p-3 rounded-lg text-sm font-medium bg-green-600 text-white text-center hover:bg-green-700 transition-colors duration-200">
                        In Bài 3 / Xuất PDF
                    </a>
                </div>

                <!-- Phần 1: Tình huống sư phạm -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Phần 1: Tình huống sư phạm</h3>
                    <p class="text-gray-700 leading-relaxed">
                        Bạn cần thiết kế một mô hình mô phỏng cơ chế tái bản DNA bằng HTML + CSS + Javascript để học sinh có thể trực quan hóa và thao tác. Bạn quyết định sử dụng AI để hỗ trợ lập trình. Làm thế nào để ra lệnh cho AI một cách hiệu quả nhất để nó tạo ra một sản phẩm code chính xác và có tính sư phạm? Làm thế nào để khắc phục lỗi code khi AI tạo ra sản phẩm bị lỗi?
                    </p>
                </div>

                <!-- Phần 2: Thiết lập nền tảng -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Phần 2: Thiết lập nền tảng</h3>
                    <div class="space-y-4 text-gray-700">
                        <div>
                            <p><strong>1. Xác định mục tiêu nội dung/chủ đề lập trình?</strong></p>
                            <textarea class="answer-box" rows="3" placeholder="Nhập câu trả lời của bạn..."></textarea>
                        </div>
                        <p><strong>2. Xác định các công cụ lập trình sẽ sử dụng?</strong></p>
                        <div class="space-y-2 ml-5 text-gray-700 mt-2">
                            <!-- Checkboxes -->
                            <div class="flex items-center">
                                <input id="bt3-tool-html" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="bt3-tool-html" class="ml-3 block text-gray-900">HTML / CSS / Javascript</label>
                            </div>
                            <div class="flex items-center">
                                <input id="bt3-tool-p5" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="bt3-tool-p5" class="ml-3 block text-gray-900">p5.js (Thư viện mô phỏng/đồ họa)</label>
                            </div>
                            <div class="flex items-center">
                                <input id="bt3-tool-three" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="bt3-tool-three" class="ml-3 block text-gray-900">three.js (Thư viện 3D)</label>
                            </div>
                            <div class="flex items-center">
                                <input id="bt3-tool-other" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="bt3-tool-other" class="ml-3 block text-gray-900">Công cụ khác (Ví dụ: Thư viện âm thanh, Physic Engine...)</label>
                            </div>
                        </div>
                        <div>
                            <p><strong>3. Thời gian hoàn thành sản phẩm lập trình?</strong></p>
                            <textarea class="answer-box" rows="2" placeholder="Nhập câu trả lời của bạn..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Phần 3: Nhiệm vụ kiến tạo -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Phần 3: Nhiệm vụ kiến tạo</h3>
                    <div class="space-y-4 text-gray-700">
                        <div>
                            <p><strong>1. Lập kế hoạch chi tiết cho sản phẩm lập trình:</strong></p>
                            <textarea class="answer-box" rows="4" placeholder="Mô tả các thành phần, chức năng, giao diện của mô phỏng DNA..."></textarea>
                        </div>
                        <div>
                            <p><strong>2. Xác định các bước dò lỗi code (debugging) khi sản phẩm bị lỗi:</strong></p>
                            <textarea class="answer-box" rows="3" placeholder="Liệt kê các bước bạn sẽ làm để tìm và khắc phục lỗi code..."></textarea>
                        </div>
                        <div>
                            <p><strong>3. Viết Prompt (câu lệnh) cho AI để tạo code:</strong></p>
                            <p class="p-3 bg-gray-100 rounded-md border border-gray-200 text-sm mt-2">
                                <strong>(Prompt mẫu):</strong> "Hãy viết code p5.js mô phỏng 4 giai đoạn tái bản DNA, có enzyme là hình tròn, có âm thanh click..."
                            </p>
                            <!-- Thêm ID để JS có thể lấy giá trị -->
                            <textarea id="bt3-prompt-answer" class="answer-box" rows="6" placeholder="Viết prompt của bạn tại đây..."></textarea>
                            
                            <!-- NÚT TÍCH HỢP GEMINI API -->
                            <div class="mt-4">
                                <button id="gemini-improve-prompt-btn" class="flex items-center justify-center gap-2 w-full px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors duration-200">
                                    ✨ Cải thiện Prompt (với Gemini)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Phần 4: Thử thách sáng tạo -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">Phần 4: Thử thách sáng tạo</h3>
                    
                    <!-- BỔ SUNG ĐỀ BÀI -->
                    <p class="text-gray-700 leading-relaxed mb-4">
                        <strong>Đề bài:</strong> Tích hợp công cụ HTML + CSS + Javascript - hoclaptrinh.io – Github để thiết kế mô phỏng cơ chế tái bản DNA và hướng dẫn/ kế hoạch giáo dục định hướng HS phát triển năng lực STEM với quy trình phát triển sản phẩm bằng ngôn ngữ lập trình
                    </p>
                    
                    <p class="text-gray-700">Sản phẩm mẫu: <a href="https://myletoday-oss.github.io/Fubao/" target="_blank" class="text-blue-600 hover:underline">https://myletoday-oss.github.io/Fubao/</a></p>
                    <p class="text-gray-700 font-medium mt-4">Yêu cầu:</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2 mt-2">
                        <li><strong>Vận hành công cụ:</strong>
                            <ul class="list-circle list-inside ml-5">
                                <li>Gửi Prompt ở Phần 3 cho AI (Gemini/GPT).</li>
                                <li>"Tích hợp nội dung" (code) mà AI trả về vào hoclaptrinh.io.</li>
                            </ul>
                        </li>
                        <li><strong>Kiểm thử (Testing) & Lặp lại:</strong>
                            <ul class="list-circle list-inside ml-5">
                                <li>"Chạy thử" code.</li>
                                <li>(Quan trọng) "Phát hiện lỗi logic hoặc giao diện" (VD: enzyme chạy quá nhanh, lệch giao diện).</li>
                                <li>"Khắc phục" bằng cách quay lại AI, "mô tả lỗi đang gặp" và yêu cầu nó sửa (sử dụng "AI hỗ trợ dò lỗi code").</li>
                                <li>Lặp lại chu trình (Dán code mới -> Chạy thử -> Phát hiện lỗi -> Yêu cầu AI sửa) cho đến khi sản phẩm "ổn định".</li>
                            </ul>
                        </li>
                        <li><strong>Chia sẻ (Optional):</strong>
                            <ul class="list-circle list-inside ml-5">
                                <li>Khi đã ổn định, "Đưa sản phẩm lên GitHub" và kích hoạt GitHub Pages.</li>
                            </ul>
                        </li>
                         <li><strong>Vận dụng Sư phạm:</strong> thiết kế hướng dẫn/ kế hoạch giáo dục định hướng HS phát triển năng lực STEM với quy trình phát triển sản phẩm bằng ngôn ngữ lập trình.</li>
                    </ul>
                    <div>
                        <p class="text-gray-700 font-medium mt-4">Sản phẩm: Nộp lại 01 link GitHub Pages (sản phẩm mẫu) VÀ 01 đoạn phản tư sư phạm.</p>
                        <input type="text" class="answer-box" placeholder="Dán link GitHub Pages tại đây...">
                        <textarea class="answer-box mt-4" rows="5" placeholder="Viết đoạn phản tư sư phạm của bạn tại đây..."></textarea>
                    </div>
                </div>
            </div>
            
        </main>
    </div>

    <!-- Modal cho Tính năng Gemini -->
    <div id="gemini-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center">
                <h3 id="gemini-modal-title" class="modal-title">Đang tải...</h3>
                <button id="gemini-modal-close" class="text-gray-400 hover:text-gray-600">&times;</button>
            </div>
            <div id="gemini-modal-body-content" class="modal-body mt-4">
                <div class="flex justify-center items-center h-24">
                    <div class="modal-spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page-content');

            // Hàm để hiển thị trang và cập nhật link active
            function showPage(targetId) {
                // Ẩn tất cả các trang
                pages.forEach(page => {
                    page.classList.remove('active');
                });
                
                // Hiển thị trang mục tiêu
                const targetPage = document.getElementById(targetId);
                if (targetPage) {
                    targetPage.classList.add('active');
                }

                // Cập nhật trạng thái active cho các link
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.target === targetId) {
                        link.classList.add('active');
                    }
                });
            }

            // Thêm sự kiện click cho mỗi link điều hướng
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault(); // Ngăn hành vi mặc định của thẻ <a>
                    const targetId = e.currentTarget.dataset.target;
                    showPage(targetId);
                });
            });

            // Hiển thị trang chủ khi tải lần đầu
            showPage('page-home');

            // --- Logic cho Bài tập 2, Phần 2 (Tái lập nội dung số) ---
            const q1Radios = document.querySelectorAll('input[name="hoc-lieu-type"]');
            
            const q2aRadio = document.getElementById('q2-a-flipbook');
            const q2aDetails = document.getElementById('q2-a-details');
            const q2aLabel = document.querySelector('label[for="q2-a-flipbook"]');

            const q2bRadio = document.getElementById('q2-b-website');
            const q2bDetails = document.getElementById('q2-b-details');
            const q2bLabel = document.querySelector('label[for="q2-b-website"]');
            
            q1Radios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const selectedValue = e.target.value;

                    if (selectedValue === 'flipbook') {
                        // Kích hoạt lựa chọn A
                        q2aRadio.disabled = false;
                        q2aRadio.checked = true;
                        q2aLabel.classList.remove('cursor-not-allowed', 'text-gray-500');
                        q2aLabel.classList.add('text-gray-900');
                        q2aDetails.classList.remove('hidden');

                        // Vô hiệu hóa lựa chọn B
                        q2bRadio.disabled = true;
                        q2bRadio.checked = false;
                        q2bLabel.classList.add('cursor-not-allowed', 'text-gray-500');
                        q2bLabel.classList.remove('text-gray-900');
                        q2bDetails.classList.add('hidden');

                    } else if (selectedValue === 'website') {
                        // Kích hoạt lựa chọn B
                        q2bRadio.disabled = false;
                        q2bRadio.checked = true;
                        q2bLabel.classList.remove('cursor-not-allowed', 'text-gray-500');
                        q2bLabel.classList.add('text-gray-900');
                        q2bDetails.classList.remove('hidden');

                        // Vô hiệu hóa lựa chọn A
                        q2aRadio.disabled = true;
                        q2aRadio.checked = false;
                        q2aLabel.classList.add('cursor-not-allowed', 'text-gray-500');
                        q2aLabel.classList.remove('text-gray-900');
                        q2aDetails.classList.add('hidden');
                    }
                });
            });
            
            // --- Logic cho nút In ---
            // Xóa trình nghe cũ (nếu có) và thêm trình nghe mới cho các nút theo lớp
            const printButtons = document.querySelectorAll('.print-exercise-button');
            printButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.print();
                });
            });

            // --- LOGIC TÍCH HỢP GEMINI API (ĐÃ KHÔI PHỤC) ---

            const modal = document.getElementById('gemini-modal');
            const modalCloseBtn = document.getElementById('gemini-modal-close');
            const modalTitle = document.getElementById('gemini-modal-title');
            const modalBody = document.getElementById('gemini-modal-body-content');
            const spinnerHTML = `<div class="flex justify-center items-center h-24"><div class="modal-spinner"></div></div>`;

            // Mở modal
            function openModal(title) {
                modalTitle.textContent = title;
                modalBody.innerHTML = spinnerHTML; // Hiển thị spinner
                modal.classList.add('active');
            }

            // Đóng modal
            function closeModal() {
                modal.classList.remove('active');
            }
            modalCloseBtn.addEventListener('click', closeModal);

            // Hàm gọi API Gemini với xử lý lỗi và thử lại (exponential backoff)
            async function callGeminiAPI(userPrompt, systemPrompt = "", maxRetries = 3) {
                const apiKey = ""; // API key sẽ được cung cấp tự động khi chạy
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userPrompt }] }],
                };

                if (systemPrompt) {
                    payload.systemInstruction = {
                        parts: [{ text: systemPrompt }]
                    };
                }

                let attempt = 0;
                let delay = 1000; // 1 giây

                while (attempt < maxRetries) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            if (response.status === 429 || response.status >= 500) {
                                // Lỗi có thể thử lại (Rate limit hoặc lỗi server)
                                throw new Error(`Lỗi API: ${response.status}`);
                            } else {
                                // Lỗi không nên thử lại (ví dụ: 400 Bad Request)
                                const errorResult = await response.json();
                                return { error: `Lỗi API: ${errorResult.error?.message || response.statusText}` };
                            }
                        }

                        const result = await response.json();
                        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                        if (text) {
                            return { text: text };
                        } else {
                            return { error: "Không nhận được nội dung hợp lệ từ API." };
                        }

                    } catch (error) {
                        attempt++;
                        if (attempt >= maxRetries) {
                            return { error: `Đã hết số lần thử. Lỗi cuối cùng: ${error.message}` };
                        }
                        // Chờ trước khi thử lại
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Tăng gấp đôi thời gian chờ
                    }
                }
                return { error: "Đã xảy ra lỗi không xác định." };
            }

            // --- 1. Xử lý cho "Gợi ý Kế hoạch E-learning" (Bài 1) ---
            const suggestPlanBtn = document.getElementById('gemini-suggest-plan-btn');
            if (suggestPlanBtn) {
                suggestPlanBtn.addEventListener('click', async () => {
                    const topic = document.getElementById('bt1-q1-answer').value;
                    
                    if (!topic.trim()) {
                        alert("Vui lòng nhập Mục tiêu/Chủ đề (Phần 2, Câu 1) trước khi dùng tính năng này.");
                        return;
                    }

                    openModal("Đang tạo gợi ý kế hoạch...");

                    const systemPrompt = "Bạn là chuyên gia thiết kế E-learning (instructional designer) cho giáo viên Sinh học lớp 10 tại Việt Nam. Bạn rất giỏi trong việc tạo các hoạt động tương tác bằng H5P.";
                    const userPrompt = `Dựa trên tình huống sư phạm (cuộc thi thiết kế E-learning) và chủ đề sau: "${topic}", hãy tạo giúp tôi một kế hoạch E-learning (khoảng 5 bước) để triển khai bằng H5P.

Với mỗi bước, hãy:
1.  Đặt tên cho Hoạt động (ví dụ: Khởi động, Khám phá...).
2.  Đề xuất một loại nội dung H5P phù hợp (ví dụ: Interactive Video, Course Presentation, Quiz...).
3.  Mô tả ngắn gọn nội dung/mục tiêu của hoạt động đó.`;

                    const result = await callGeminiAPI(userPrompt, systemPrompt);

                    if (result.error) {
                        modalTitle.textContent = "Lỗi";
                        modalBody.textContent = result.error;
                    } else {
                        modalTitle.textContent = "✨ Gợi ý Kế hoạch E-learning";
                        modalBody.textContent = result.text;
                    }
                });
            }

            // --- 2. Xử lý cho "Cải thiện Prompt" (Bài 3) ---
            const improvePromptBtn = document.getElementById('gemini-improve-prompt-btn');
            if (improvePromptBtn) {
                improvePromptBtn.addEventListener('click', async () => {
                    const userPrompt = document.getElementById('bt3-prompt-answer').value;

                    if (!userPrompt.trim()) {
                        alert("Vui lòng nhập nội dung prompt của bạn (Phần 3, Câu 3) trước khi dùng tính năng này.");
                        return;
                    }

                    openModal("Đang cải thiện prompt...");

                    const systemPrompt = "Bạn là một kỹ sư prompt (prompt engineer) chuyên nghiệp, làm việc với các mô hình AI tạo code (như p5.js, HTML/CSS/JS). Nhiệm vụ của bạn là nhận một prompt cơ bản từ người dùng (giáo viên Sinh học) và viết lại nó một cách chi tiết, rõ ràng, chính xác về mặt kỹ thuật để AI có thể tạo ra sản phẩm mô phỏng tốt nhất.";
                    const apiPrompt = `Hãy cải thiện prompt sau đây để ra lệnh cho AI tạo code (HTML/CSS/JS, có thể dùng p5.js hoặc three.js) mô phỏng sinh học.
Prompt gốc của người dùng:
"${userPrompt}"

Hãy viết lại prompt mới, thêm các chi tiết quan trọng như:
-   Các thành phần (elements) cụ thể (ví dụ: enzyme, sợi DNA, nucleotide).
-   Các giai đoạn hoặc bước (steps) của quá trình.
-   Các tương tác (ví dụ: nút bấm "Start", "Pause", "Reset").
-   Màu sắc và kiểu dáng (ví dụ: "Sợi DNA A-T có màu đỏ, G-C có màu xanh").
-   Ghi rõ "Prompt đã cải thiện:" ở đầu kết quả của bạn.`;

                    const result = await callGeminiAPI(apiPrompt, systemPrompt);

                    if (result.error) {
                        modalTitle.textContent = "Lỗi";
                        modalBody.textContent = result.error;
                    } else {
                        modalTitle.textContent = "✨ Prompt đã được cải thiện";
                        modalBody.textContent = result.text;
                    }
                });
            }
        });
    </script>
</body>
</html>
